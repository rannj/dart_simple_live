name: app-build-action

# æ¨é€Tagæ—¶è§¦å‘
on:
  workflow_dispatch:
  # push:
  #   tags:
  #     - "v*"

jobs:
  # åªæ‰“åŒ…Windows
  build-windows:
    runs-on: windows-latest
    permissions:
      contents: write
    steps:
      # ç­¾å‡ºä»£ç 
      - uses: actions/checkout@v4
        with:
          ref: master

      # è®¾ç½®Flutterç¯å¢ƒ
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.22.x"
          cache: true

      # å¯ç”¨Windows Desktopæ”¯æŒ
      - name: Enable Flutter Desktop
        run: flutter config --enable-windows-desktop

      # æ›´æ–°Flutterçš„packages
      - name: Restore Packages
        run: |
          cd simple_live_app
          flutter pub get

      # è®¾ç½®flutter_distributorç¯å¢ƒ
      - name: Install flutter_distributor
        run: dart pub global activate flutter_distributor

      # build Windows ZIP (åªç”ŸæˆZIPï¼Œç§»é™¤MSIX)
      - name: Build Windows ZIP
        run: |
          cd simple_live_app
          # åªæŒ‡å®šç”Ÿæˆ zip æ ¼å¼
          flutter_distributor package --platform windows --targets zip --skip-clean

      # è¯»å–ç‰ˆæœ¬ä¿¡æ¯
      - name: Read version
        id: version
        uses: juliangruber/read-file-action@v1
        with:
          path: simple_live_app/assets/app_version.json

      # ä¸Šä¼ è‡³Release (åªä¸Šä¼ Windows ZIPæ–‡ä»¶)
      - name: Upload Release
        uses: softprops/action-gh-release@v1
        with:
          name: "${{ fromJson(steps.version.outputs.content).version }}"
          body: "${{ fromJson(steps.version.outputs.content).version_desc }}"
          prerelease: ${{ fromJson(steps.version.outputs.content).prerelease }}
          token: ${{ secrets.TOKEN }}
          æ–‡ä»¶: |
            simple_live_app/build/dist/*/*.zip # ç¡®ä¿åªä¸Šä¼ zipæ–‡ä»¶

      # å®Œæˆ
      - run: echo "ğŸ Windows job's status is ${{ job.status }}."
